# Реестр акционеров

Приложение для управления реестром акционеров компании, разработанное с использованием Qt и PostgreSQL.

## Описание

Данное приложение предназначено для ведения учета акционеров компании, их ценных бумаг, собраний акционеров и других связанных данных. Приложение имеет разграничение прав доступа на основе ролей пользователей.

## Основные функции

- Управление данными об акционерах
- Учет ценных бумаг и их владельцев
- Организация собраний акционеров
- Учет присутствия акционеров на собраниях
- Отслеживание операций с акциями
- Формирование отчетов
- Управление пользователями (для администраторов)

## Новые функции

- **Диалоги для редактирования данных**: Теперь при добавлении и редактировании записей открываются отдельные диалоговые окна с удобными формами ввода
- **Редактирование по двойному клику**: Двойной клик по записи в таблице открывает диалог редактирования
- **Улучшенный отчет посещаемости**: Исправлена проблема с отображением отчета по посещаемости собраний

## Требования

- Qt 5.12 или выше
- PostgreSQL 12 или выше
- Драйвер PostgreSQL для Qt (QPSQL)

## Установка и настройка

1. Установите PostgreSQL и создайте базу данных:
   ```
   createdb stocks
   ```

2. Выполните скрипт создания таблиц и ролей:
   ```
   psql -d stocks -f setup_roles_and_tables.sql
   ```

3. Скомпилируйте и запустите приложение:
   ```
   qmake
   make
   ./stocks
   ```

## Роли пользователей

- **Администратор** (admin_role): Полный доступ ко всем функциям
- **Пользователь** (user_role): Ограниченный доступ (только просмотр и редактирование определенных данных)

## Структура базы данных

- **Акционер**: Информация об акционерах
- **Ценные_бумаги**: Информация о пакетах акций
- **Владельцы_ценных_бумаг**: Связь между акционерами и их ценными бумагами
- **Собрание_акционеров**: Информация о собраниях
- **Присутствие**: Учет присутствия акционеров на собраниях
- **Операция_с_акцией**: История операций с акциями

## Авторы

- Номоконов Владислав

## Лицензия

Это приложение распространяется под лицензией [указать лицензию].

## Функциональность

- Управление списком акционеров
- Учет ценных бумаг
- Отслеживание владельцев ценных бумаг
- Управление собраниями акционеров
- Контроль присутствия на собраниях
- Учет операций с акциями
- Формирование отчетов
- Разграничение прав доступа (роли admin и user)

## Установка и запуск

### Требования

- Qt 5.12 или выше
- PostgreSQL 12 или выше
- Компилятор C++ с поддержкой C++11

### Настройка базы данных

1. Установите PostgreSQL, если он еще не установлен
2. Создайте базу данных с именем "stocks":
   ```
   createdb -U postgres stocks
   ```
3. Импортируйте структуру базы данных и роли пользователей:
   ```
   psql -U postgres -d stocks -f create_database.sql
   ```
4. После выполнения скрипта будут созданы:
   - Все необходимые таблицы
   - Две роли: admin_role и user_role с разными уровнями доступа
   - Два тестовых пользователя:
     - Администратор: логин `postgres`, пароль `ваш пароль`
     - Пользователь: (ваши пользователи)

### Компиляция и запуск приложения

1. Откройте проект в Qt Creator:
   ```
   qtcreator stocks.pro
   ```
2. Настройте проект для вашей системы
3. Соберите и запустите приложение

Либо выполните следующие команды в терминале:

```
qmake
make
./stocks
```

## Работа с приложением

### Вход в систему

При запуске приложения появится диалог входа, где вы можете:
1. Указать параметры подключения к базе данных (сервер, порт, имя БД, имя пользователя, пароль)
2. Выбрать роль: Администратор или Пользователь

### Роли пользователей

1. **Администратор (admin)**
   - Полный доступ ко всем функциям системы
   - Возможность добавлять/удалять/редактировать все данные
   - Доступ к управлению пользователями
   - Полный доступ к отчетам

2. **Пользователь (user)**
   - Просмотр всех данных
   - Добавление и редактирование акционеров
   - Добавление записей о присутствии
   - Просмотр отчетов
   - Нет доступа к управлению пользователями и созданию/удалению пакетов акций

### Функциональные вкладки

1. **Акционеры** - управление данными акционеров
2. **Ценные бумаги** - управление пакетами акций
3. **Владельцы ценных бумаг** - связь между акционерами и пакетами акций
4. **Собрания акционеров** - управление собраниями
5. **Присутствие** - учет присутствия акционеров на собраниях
6. **Операции с акциями** - учет передачи акций между акционерами
7. **Отчеты** - просмотр различных отчетов
8. **Пользователи** - управление пользователями (только для администратора)

## Настройка базы данных в PgAdmin 4

Если вы используете PgAdmin 4 для управления базой данных:

1. Откройте PgAdmin 4
2. Создайте новую базу данных `stocks`
3. Щелкните правой кнопкой мыши на базе данных и выберите "Query Tool"
4. Вставьте содержимое файла `create_database.sql` и выполните его

### Подключение к базе данных из приложения

При запуске приложения в диалоге входа укажите:
- Сервер: localhost (или IP-адрес сервера PostgreSQL)
- Порт: 5432 (стандартный порт PostgreSQL)
- База данных: stocks
- Имя пользователя: ваше имя пользователя PostgreSQL (обычно postgres)
- Пароль: ваш пароль PostgreSQL
- Роль: Администратор или Пользователь 
